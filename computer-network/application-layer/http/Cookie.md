#web #application-layer #computer-network #client-server #http #cookie
#cybersecurity 

- HTTP is stateless, but cookie helps maintain client's state.
# Architecture
- The user visits the website for the first time and his cookie is now empty.
- The server processes the request, modifies the cookie and replies a response with `Set-Cookie` header to the client. The header contains the cookie content and its expiration time.
- The browser automatically stores that cookie with its domain. The subsequent requests to the same domain will include `Cookie` property until its expiration time.
- ![](Pasted%20image%2020240512111550.png)
# Format
- The `Content` field takes the form `name = value`.
- The `Expires` field specifies when the cookie expires. If this field is absent, the browser discards the cookie when it exits (*non-persistent* cookie). If the expiration time is specified, the cookie is a *persistent* cookie. 
- The `Secure` field can be set to indicate that the browser may only return the cookie to a server using a secure transport, typically [[Secure Socket Layer (SSL) - Transport Layer Security (TLS)]]
- The `HttpOnly` blocks the cookie from being accessed by JavaScript, thereby mitigating Cross-Site Scripting (XSS) attacks.
- ![[Pasted image 20251023090535.png]]
# Example
- The server replies to the client with the response having `set-cookie` header. 
```HTTP title='HTTP Response to set cookie header'
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Set-Cookie: sessionId=abc123xyz; Path=/; HttpOnly; Secure; SameSite=Strict
Set-Cookie: theme=dark; Expires=Wed, 21 Oct 2026 07:28:00 GMT; Path=/
Content-Length: 45

<html>Welcome back!</html>
```
- Then, every subsequent request to the same domain will include:
```HTTP title='Cookie header in subsequent requests'
Cookie: sessionId=abc123xyz; theme=dark
```
# Security
## Third-party tracking cookie
- Client side privately keeps cookie unique by an id generated by server. This is a *first-party* cookie.
- A *third-party* cookie is set by a *different domains* than the website being currently visited by the user. For instance, it can be a advertisement iframe or script.
- When the user visits another website, the browser also sends the cookie *containing the identity* of that user to the advertisement network.
- The tracker knows that user has visited the two websites, thus links his behavior across the domain.
- ![](Pasted%20image%2020240512111817.png)

# Usage
## Session authentication
- Upon sign-in, the server uses the `Set-Cookie` HTTP header in the response to set a cookie with a unique <mark class="hltr-yellow">session identifier</mark>.
- On subsequent requests to the same domain, the browser sends the cookie over the net using the `Cookie` HTTP header.
-  Extracting and validating the `Cookie` header of the request, the server knows who made the request.
- ![[Pasted image 20251021212910.png]]
## Personalization

## Activity tracking
# References
1. Computer Networking  A Top-Down Approach, Global Edition, 8th Edition - James F. Kurose - Keith W. Ross.
2. https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/Cookies
3. https://expressjs.com/en/resources/middleware/cookie-parser.html for Cookie management library for ExpressJs.
4. [[Secure Socket Layer (SSL) - Transport Layer Security (TLS)]]
5. [[programming/javascript/browser/Cookie|Cookie]] for using JavaScript to manage browser cookie.
6. [[Cross-Origin Resource Sharing (CORS)]] for CORS security issue.