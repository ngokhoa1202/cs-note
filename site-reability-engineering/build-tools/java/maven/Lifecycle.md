#maven #dependency-manager #java #spring #spring-boot #build-lifecycle #quarkus #micronaut 
# Definition
- A build lifecycle is a well-defined <mark class="hltr-yellow">sequence of phases</mark> that define the order in which goals are executed. Maven has three built-in build lifecycles:
1. **default** - handles project deployment
2. **clean** - handles project cleaning
3. **site** - handles project site documentation creation
- Each lifecycle consists of a sequence of **phases**, and each phase consists of a sequence of **goals**. When a phase is executed, all previous phases in the lifecycle are executed first.
# Maven Build Lifecycles Architecture

```mermaid title='Maven lifecycle'
graph TB
    subgraph "Clean Lifecycle"
        C1[pre-clean]
        C2[clean]
        C3[post-clean]
        C1 --> C2 --> C3
    end

    subgraph "Default Lifecycle"
        D1[validate]
        D2[compile]
        D3[test]
        D4[package]
        D5[verify]
        D6[install]
        D7[deploy]

        D1 --> D2 --> D3 --> D4 --> D5 --> D6 --> D7

        D1_1[initialize] -.-> D1
        D2_1[generate-sources] -.-> D2
        D2_2[process-sources] -.-> D2
        D2_3[generate-resources] -.-> D2
        D2_4[process-resources] -.-> D2
        D3_1[test-compile] -.-> D3
        D3_2[process-test-resources] -.-> D3
        D4_1[prepare-package] -.-> D4
        D5_1[integration-test] -.-> D5
    end

    subgraph "Site Lifecycle"
        S1[pre-site]
        S2[site]
        S3[post-site]
        S4[site-deploy]
        S1 --> S2 --> S3 --> S4
    end

    style D2 fill:#90EE90
    style D3 fill:#87CEEB
    style D4 fill:#FFD700
    style D6 fill:#FFA500
    style D7 fill:#FF6347
```

## Default Lifecycle Phases
### 1. validate
#### Purpose
- Validate the project is correct and all necessary information is available.
#### Input
- `pom.xml` file.
- Project structure.
#### Output
- Validation status.
- Error messages if configuration is invalid.
```Shell title='validate phase'
mvn validate
```
### 2. compile
#### Purpose
 - Compile the source code of the project.
#### Input
- `src/main/java/**/*.java` (source files).
- `src/main/resources/**/*` (resource files).
- Dependencies from `pom.xml`.
#### Output
- Compiled `.class` files in `target/classes/`.
- Processed resources in `target/classes/`.
```Shell title='compile phase'
mvn compile
```
### 3. test
#### Purpose
- Test the compiled source code using a suitable unit testing framework.
#### Input
- Compiled classes from `target/classes/`
- Test source files from `src/test/java/`
- Test resources from `src/test/resources/`
- Test dependencies.
#### Output
- Compiled test classes in `target/test-classes/`
- Test results in `target/surefire-reports/`
- Console output with test summary (passed/failed/skipped).
```Shell title='test phase'
mvn test
```

```Shell title='Skip tests'
mvn test -DskipTests         # Compile tests but don't run
mvn test -Dmaven.test.skip=true  # Don't compile or run tests
```
### 4. package
#### Purpose
- Package compiled code into distributable format (JAR, WAR, EAR).
#### Input
- Compiled classes from `target/classes/`.
- Resources.
- `pom.xml` metadata (version, artifact name, packaging type).
#### Output
- Packaged artifact in `target/` directory:
  - `target/<artifactId>-<version>.jar` (for JAR packaging)
  - `target/<artifactId>-<version>.war` (for WAR packaging)
```Shell title='package phase'
mvn package
```
### 5. verify
#### Purpose 
- Run integration tests and checks to ensure *quality criteria* are met.
#### Input
- Packaged artifact from `target/`
- Integration test configurations.
- Quality check plugins (e.g., Checkstyle, PMD)
##### Output
- Integration test results.
- Quality check reports.
- Verification status.
```Shell title='verify phase'
mvn verify
```
### 6. install
#### Purpose
- Install the package into the local repository (`~/.m2/repository`)
#### Input
- Packaged artifact from `target/`.
- `pom.xml` metadata.
#### Output
- Artifact installed in local Maven repository:
    - `~/.m2/repository/<groupId>/<artifactId>/<version>/<artifactId>-<version>.jar`
    - `~/.m2/repository/<groupId>/<artifactId>/<version>/<artifactId>-<version>.pom`
```Shell title='Install phase'
mvn install
```
### 7. deploy
#### Purpose
- Copy the final package to remote repository for sharing with other developers.
#### Input
- Packaged artifact from `target/`
- `pom.xml` with `<distributionManagement>` configuration.
- Remote repository credentials.
#### Output
- Artifact deployed to remote repository (Nexus, Artifactory, etc).
- Updated repository metadata.
```Shell title='Deploy phase'
mvn deploy
```
## Clean Lifecycle Phases
### clean
#### Purpose
- Remove all files generated by the previous build.
#### Input 
- `target/` directory
#### Output
- Deleted `target/` directory and all contents
```Shell title='clean phase'
mvn clean
```
#### Usage
```Shell title='Common usage of clean phase'
mvn clean install    # Clean then install
mvn clean package    # Clean then package
```
## Site Lifecycle Phases
### site
#### Purpose
- Generate project documentation and reports.
#### Input
- `src/site/` directory (if exists)
- `pom.xml` project information
- Generated reports (JavaDoc, test coverage, etc.)
#### Output
- Project site in `target/site/`
- HTML documentation.
- Generated reports.
```Shell title='site phase'
mvn site
```
### site-deploy
#### Purpose
- Deploy generated site to remote web server.
#### Input
- Generated site from `target/site/`.
- Site deployment configuration from `pom.xml`.
#### Output
- Site deployed to configured server,
```Shell title='site deplou phase'
mvn site-deploy
```
# Phase Execution Flow
```mermaid
sequenceDiagram
    participant User
    participant Maven
    participant Plugins
    participant FileSystem
    participant Repository

    User->>Maven: mvn package
    Maven->>Plugins: Execute validate phase
    Plugins->>FileSystem: Read pom.xml
    FileSystem-->>Plugins: Project configuration

    Maven->>Plugins: Execute compile phase
    Plugins->>FileSystem: Read src/main/java
    Plugins->>FileSystem: Write target/classes

    Maven->>Plugins: Execute test phase
    Plugins->>FileSystem: Read src/test/java
    Plugins->>FileSystem: Write target/test-classes
    Plugins->>FileSystem: Write target/surefire-reports

    Maven->>Plugins: Execute package phase
    Plugins->>FileSystem: Read target/classes
    Plugins->>FileSystem: Write target/*.jar

    FileSystem-->>Maven: Build SUCCESS
    Maven-->>User: BUILD SUCCESS
```
## Common Lifecycle Combinations

| Command | Phases Executed | Use Case |
|---------|----------------|----------|
| `mvn clean` | pre-clean → clean → post-clean | Remove build artifacts |
| `mvn compile` | validate → compile | Quick compilation check |
| `mvn test` | validate → compile → test | Run unit tests |
| `mvn package` | validate → compile → test → package | Create distributable artifact |
| `mvn verify` | validate → compile → test → package → verify | Run integration tests |
| `mvn install` | All phases up to install | Install to local repository |
| `mvn deploy` | Complete default lifecycle | Deploy to remote repository |
| `mvn clean install` | Clean lifecycle + default lifecycle up to install | Fresh build and install |
| `mvn clean package -DskipTests` | Clean + package without tests | Fast packaging for development |
## Lifecycle Phase Dependencies

```mermaid
graph LR
    A[User runs: mvn install]
    A --> B[Maven executes phases in order]

    B --> C[validate]
    C --> D[compile]
    D --> E[test]
    E --> F[package]
    F --> G[verify]
    G --> H[install]

    style A fill:#FFE4B5
    style H fill:#90EE90
```

- When a specific phase is executed, all preceding phases in the lifecycle are automatically executed first.
## Plugin Goals Binding
- Each lifecycle phase has default plugin goals bound to it based on packaging type:
### JAR Packaging
- `compile` → `compiler:compile`
- `test` → `surefire:test`
- `package` → `jar:jar`
- `install` → `install:install`
- `deploy` → `deploy:deploy`
### WAR Packaging
- `compile` → `compiler:compile`
- `test` → `surefire:test`
- `package` → `war:war`
- `install` → `install:install`
- `deploy` → `deploy:deploy`
# Directory Structure Input/Output
```
project-root/
├── pom.xml                    # INPUT: Project configuration
├── src/
│   ├── main/
│   │   ├── java/             # INPUT: Source code
│   │   └── resources/        # INPUT: Resources
│   └── test/
│       ├── java/             # INPUT: Test code
│       └── resources/        # INPUT: Test resources
└── target/                    # OUTPUT: All generated files
    ├── classes/              # OUTPUT: Compiled main classes
    ├── test-classes/         # OUTPUT: Compiled test classes
    ├── surefire-reports/     # OUTPUT: Test results
    ├── <artifact>-<version>.jar  # OUTPUT: Packaged artifact
    └── site/                 # OUTPUT: Generated documentation
```
---
# References
1. https://contabo.com/blog/maven-commands-cheat-sheet/ for maven commands
2. https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html - Official Maven lifecycle documentation
